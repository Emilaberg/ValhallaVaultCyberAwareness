@page "/Q"
@using ValhallaVaultCyberAwareness.Data.Models
@using ValhallaVaultCyberAwareness.Repositories
@rendermode InteractiveServer
@attribute [StreamRendering]
@inject IValhallaUow Uow;


<h3>Questions</h3>
<p style="color:white">Question @currentQuestion / @AllQuestions.Count</p>
@if(AllQuestions == null)
{
    <div>Loading...</div>
}else
{
    <div>
        @if(currentQuestion != AllQuestions.Count + 1)
        {
            <div>
                <h1 style="color:white;">
                    @AllQuestions[currentQuestion - 1].Question
                </h1>

                <div>
                    @foreach (var prompt in AllQuestions[currentQuestion - 1].Prompts)
                    {
                        <div style="color:white;">
                            <input type="radio" id="@prompt.Id" name="prompt" value="@prompt.Id" @onclick="() => setAnswer(prompt)">
                            <label for="prompt">@prompt.Prompt</label>
                        </div>
                    }
                </div>
                @if(answeredCorrect)
                {
                    <div id="Correct" style="color:white;">
                        You answered correctly!
                    </div>
                }else if(answeredWrong)
                {
                    <div id="inCorrect" style="color:red;">
                        You answered wrong!
                    </div>
                }

                <button style="color:white;"  @onclick="CheckAnswer">check answer</button>
                @if(currentQuestion - 1 != 0)
                {
                    <button style="color:white;" @onclick="PrevQuestion">Prev question</button>
                    
                }
                @if(currentQuestion != AllQuestions.Count)
                {
                    <button style ="color:white;" @onclick="NextQuestion">Next question</button>
                    
                }


            </div>
        }
    </div>
}

@code {
    public List<QuestionModel> AllQuestions = [];
    public int currentQuestion = 1;

    public bool answeredCorrect;
    public bool answeredWrong;
    public PromptModel? answeredPrompt;

    protected override async Task OnInitializedAsync()
    {
        var questions = await Uow.QuestionRepo.GetAllQuestions();

        if(questions != null)
        {
            AllQuestions = questions;
        }

    }

    public void PrevQuestion()
    {
        if(currentQuestion == 1)
        {
            return;
        }
        currentQuestion--;
        answeredCorrect = false;
        answeredWrong = false;
        answeredPrompt = null;
    }

    public void NextQuestion()
    {
        currentQuestion++;
        answeredCorrect = false;
        answeredWrong = false;
        answeredPrompt = null;
    }

    public void CheckAnswer()
    {
        //om man trycker på check answer utan att välja ett svar
        if (answeredPrompt == null)
        {

            return;
        }

        if (answeredPrompt.IsCorrect)
        {
            answeredCorrect = true;
        }else
        {
            answeredWrong = true;
        }
    }

    public void setAnswer(PromptModel prompt)
    {
        answeredPrompt = prompt;
    }
}


